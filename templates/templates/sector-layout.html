{% extends "templates/templates/sector_page_layout.html" %}

{% block title %}Sector {{ sector[0] }} at {{ zone_name }}{% endblock %} 
{% block description %}{{ sector[0] }} at {{ zone_name }}{% endblock%} 
{% block head %}
<link rel="canonical" href="https://www.madboulder.org/sectors/{{zone_code}}/{{sector_code}}">
{% endblock%} 

{% block sector_name %} Sector {{ sector[0] }}, {{ zone_name }} {% endblock %} 

{% block body %}
	{% if video_url %}
		<div class="video-container" >
			<iframe src="{{ video_url }}" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
		</div>
	{% endif %}
	<!--Problem List-->
	<h2 style="clear:both;display:block" class="">{% raw %} {{ _("List of Problems") }} {% endraw %}</h2>
	<div class="container">
		<input id="search-problem" class="form-control  mb-2" type="text" placeholder="Search" aria-label="Search" style="display: grid; align-self: center; border-color: black;">
		<table id="problems-table" class="table table-hover">
			<thead>
				<tr>
					{% raw %}
					<th scope="col" class="sorting">{{ _("Name") }}</th>
					<th scope="col" class="sorting">{{ _("Grade") }}</th>
					{% endraw %}
				</tr>
			</thead>
			<tbody>
				{% for problem in problems %}
					<tr class="problem-row">
						<td>
							<i class="fas fa-video-camera table-row-icon"></i>
							<a href="/problems/{{zone_code}}/{{problem['secure']}}" class="table-row-name text-bold">{{ problem["name"] }}</a>
						</td>
						<td>{{ problem["grade_with_info"] }}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
		<script>
			$.fn.dataTable.ext.type.order['vgrade-pre'] = function(data) {
				var regex = /^V(\d+)/;// Regular expression to match V-grades like 'V0', 'V1', etc.

				var match = regex.exec(data);
				if (match) {
					var numericValue = parseInt(match[1], 10);
					return numericValue;
				} else {
					return data;
				}
			};

			$(document).ready(function () {
				function filter_problems_by_query(search_query) {
					var $problems = $(".problem-row");
					if (search_query === "")
						$problems.show();
					else {
						$problems.hide();
						$problems.each(function() {
							var rowName = $(this).find(".table-row-name").text().toLowerCase();
							if (rowName.indexOf(search_query) !== -1) {
								$(this).show();
							}
						});
					}
				};
			
				$('#problems-table').DataTable({
					paging: false,
					dom: 'tr',
					columnDefs: [
						{
							targets: [1],
							type: 'vgrade',
						},
					]
				});
				
				$("#search-problem").trigger("keyup");
				
				$("#search-problem").keyup(function() {
					var search_query = $.trim($(this).val());
					filter_problems_by_query(search_query)
				});
			});
		</script>
	</div>
{% endblock %}