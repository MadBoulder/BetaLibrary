<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="Your Bouldering Beta Library" />
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-35431742-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-35431742-2");
    </script>
    <!-- Navigation bar title-->
    <title>{{ _("Areas") }}</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, text/html, charset=UTF-8"
    />
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet"> 
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script
			  src="https://code.jquery.com/jquery-3.5.1.min.js"
			  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>
    <link href="{{ url_for('static', filename='bootstrap/css/bootstrap.min.css') }}" rel="stylesheet" media="screen" />
    <script src="{{ url_for('static', filename='bootstrap/js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.translate.js') }}"></script>
    
    <link rel="stylesheet" href="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569006288/BBBootstrap/choices.min.css?version=7.0.0">
    <script src="https://res.cloudinary.com/dxfq3iotg/raw/upload/v1569006273/BBBootstrap/choices.min.js?version=7.0.0"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/madboulder.css') }}" />
    <!-- Development -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/all.css') }}" />
    <link rel="apple-touch-icon-precomposed" sizes="57x57"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152"
      href="https://madboulder.org/static/images/logo/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="https://madboulder.org/static/images/logo/favicon-196x196.png"
      sizes="196x196" />
    <link rel="icon" type="image/png" href="https://madboulder.org/static/images/logo/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="https://madboulder.org/static/images/logo/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="https://madboulder.org/static/images/logo/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="https://madboulder.org/static/images/logo/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Climbing Videos | Beta Library | MadBoulder" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="https://madboulder.org/static/images/logo/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="https://madboulder.org/static/images/logo/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="https://madboulder.org/static/images/logo/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="https://madboulder.org/static/images/logo/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="https://madboulder.org/static/images/logo/mstile-310x310.png" />
  </head>
  <body>
    <div id="current-language" hidden>{{ current_lang }}</div>
    <!-- Country Modal -->
    <div class="modal fade" id="country-modal" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">{{ _("Filter zones") }}</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <div class="row d-flex justify-content-center mt-100">
                <div class="col-md-6" id="inactive-countries-list"> 
                  <!-- <select id="choices-multiple-remove-button" placeholder="{{ _('Filter by country') }}" multiple>
                    {% for country in countries %}
                      <option value="{{ country }}">{{ _(country) }}</option>
                    {% endfor %}
                  </select>  -->
                  {% for country in countries %}
                  <div class="active-filter-selection row" id="{{ country }}">
                    <span class="active-filter-text-list-item col-6 trn" style="display: grid; align-content:center;">
                      {{ country }}
                    </span>
                    <div class="col-6" style="display: flex; justify-content: flex-end;">
                      <button class="btn" onclick="addElement(this)">
                        <i class="fas fa-plus item-icon"></i>
                      </button>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>
              <!-- <select multiple class="form-control">
                {% for country in countries %}
                  <option value="{{ country }}">{{ _(country) }}</option>
                {% endfor %}
              </select> -->
            </div>
          </div>
          <div class="modal-footer">
            <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> -->
          </div>
        </div>
      </div>
    </div>
    <!-- End Modal -->
    <div id="holder">
      <div id="body">
        <div class="homeTopnav sticky" id="myTopnav">
          <a id="logo" href="/" style="padding: 7px 16px;">
            <img
              title="Climbing Videos | Beta Library | MadBoulder"
              src="static/images/logo-menu.png"
              alt="Climbing Videos | Beta Library | MadBoulder"
              style="width: 40px; height: 40px; padding: 0px 0px;"
            />
          </a>
          <!-- <a href="/">{{ _("HOME") }}</a> -->
          <a href="/all">{{ _("MAP") }}</a>
          <a href="/zones">{{ _("ZONES") }}</a>
          <a href="/latest_videos">{{ _("LATEST VIDEOS") }}</a>
          <a href="/upload">{{ _("UPLOAD") }}</a>
          <a href="/about_us">{{ _("ABOUT US") }}</a>
          <a href="https://teespring.com/stores/madboulder" target="_blank"
            >{{ _("STORE") }}</a
          >
          <a
            href="javascript:void(0);"
            style="font-size: 17px;"
            class="icon"
            onclick="loadMenu()"
            >&#9776;</a
          >
        </div>
        <script>
          function loadMenu() {
            var x = document.getElementById("myTopnav");
            if (!x.classList.contains("responsive")) {
              x.className += " responsive";
            } else {
              if (x.classList.contains("sticky")) {
                x.className = "homeTopnav sticky";
              } else {
                x.className = "homeTopnav";
              }
            }
          }
        </script>
        <div class="container" id="mainContainer">
          <br />
          <br />
          <br />
          <br />
          <br />
          <div class="md-form active-pink active-pink-2 mt-0 row mr-0" style="display:flex; justify-content:center;">
            <input id="search-zone" class="form-control text-white" type="text" placeholder="Search" aria-label="Search" style="background-color: black; width: 45%; display: grid; align-self: center;">
            <button class="btn mr-2 ml-2" data-toggle="modal" data-target="#country-modal" style="background-color: black;">
              <span style="color: white;">{{ _("Add Filter") }}</span>
            </button>
            <!-- Sort order -->
              <div class="btn-group">
                <div style="max-width: 100%; background-color: black; display: flex; border-radius: 0.25rem;">
                  <select style="height: 100%; border-radius: inherit; padding-left: 0.2rem; align-self:center; text-align: left; text-align-last: left; appearance: none; border: none; background-color: black; color: white;"  id="sort-criteria" onchange="ReorderZones()">
                    <option value="alph" selected>{{ _("Alphabetically") }}</option>
                    <option value="nvid">{{ _("Number of videos") }}</option>
                  </select>
                <button id="btn-asc" class="btn form-group-addon" style="border-radius: 0.25rem; background-color: black;" onclick="SortAsc()">
                  <i class="fas fa-angle-up" style="color: white;"></i>
                </button>
                <button id="btn-desc" class="btn form-group-addon" style="border-radius: 0.25rem; background-color: black;" onclick="SortDesc()">
                  <i class="fas fa-angle-down" style="color: white;"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="container row" id="selected-countries" style="margin:inherit; padding: inherit;">
          </div>
          </div>
          <div class="container" id="pageContent">
            <div class="row" id="zones-list">
              {% for zone in zones %}
              <div class="custom-card" id="{{ zone['normalized_name'] }}-{{zone['country']}}">
                <div class="card text-white zone-card" style="width: 12rem; background-color:black;">
                  <a class="zone-card-link" href="/{{ zone['normalized_name'] }}" >
                    <!-- <img class="card-img-top" style="max-width:25%; display: block; margin: auto; padding-top:1rem;" src="/static/images/logo-menu.png" alt="Card image cap"> -->
                    <div class="card-body">
                      <h5 class="card-title" style="justify-content: center; text-align: center; display: flex; font-size:1.1rem;">{{ zone['name'] }}</h5>
                      <p class="card-text" data-videos="{{ zone['videos'] }}" style="justify-content: center; display: flex; font-size:10pt;">
                        {{ zone['videos'] }} {{ _("video") if zone['videos'] == 1 else _("videos") }} 
                      </p>
                    </div>
                  </a>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <br />
        <!-- Footer contains links to social networks and language selector-->
        <footer>
          <br />
          <div style="text-align: center;">
            <div style="display: inline-block;">
              <ul id="lang-selector" style="padding: 0; list-style: none;">
                <li>
                  <a
                    href="https://www.instagram.com/madboulder/"
                    target="_blank"
                    ><i style="color: #555;" class="fab fa-instagram fa-lg"></i
                  ></a>
                </li>
                &nbsp;
                <li>
                  <a
                    href="https://www.youtube.com/channel/UCX9ok0rHnvnENLSK7jdnXxA"
                    target="_blank"
                    ><i style="color: #555;" class="fab fa-youtube fa-lg"></i
                  ></a>
                </li>
                &nbsp; &nbsp;
                <li>
                  <a
                    style="color: #555;"
                    href="/language/en?origin=zones"
                    title="English"
                  >
                    {{ _("EN") }}
                  </a>
                </li>
                &nbsp;
                <li>
                  <a
                    style="color: #555;"
                    href="/language/es?origin=zones"
                    title="Spanish"
                  >
                    {{ _("ES") }}
                  </a>
                </li>
                &nbsp;
                <li>
                  <a
                    style="color: #555;"
                    href="/language/ca?origin=zones"
                    title="Catalan"
                  >
                    {{ _("CAT") }}
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div style="text-align: center;">
            <div style="display: inline-block;">
                <a 
                    style="color: #555;"
                    href="/disclosure"
                    title="Afiliate Disclosure"
                >
                    {{ _("Affiliate Disclosure") }}
                </a>
            </div>
          </div>
          <br />
        </footer>
      </div>
    </div>
  </body>
</html>

<script>
var translator;
var curr_lng = $("#current-language")[0].childNodes[0].nodeValue;
var dict = {
  "es": {
    es: "España",
    ca: "Espanya",
    en: "Spain"
  },
  "it": {
    es: "Italia",
    ca: "Itàlia",
    en: "Italy"
  },
  "ca": {
    es: "Canadá",
    ca: "Canadà",
    en: "Canada"    
  },
  "at": {
    es: "Austria",
    ca: "Àustria",
    en: "Austria"    
  },
  "fr": {
    es: "Francia",
    ca: "França",
    en: "France"    
  },
  "de": {
    es: "Alemania",
    ca: "Alemània",
    en: "Germany"    
  },
  "za": {
    es: "Sudáfrica",
    ca: "Sud-àfrica",
    en: "South Africa"    
  },
  "us": {
    es: "Estados Unidos",
    ca: "Estats Units",
    en: "United States of America"    
  },
  "ch": {
    es: "Suiza",
    ca: "Suïssa",
    en: "Switzerland"    
  }
}

function sortCountryNodesAlphabetically() {
  var items = Array.prototype.slice.call($("#inactive-countries-list")[0].children);
  items.sort(function(a, b) {
     return $(a).find(".active-filter-text-list-item")[0].innerHTML.toLowerCase().localeCompare($(b).find(".active-filter-text-list-item")[0].innerHTML.toLowerCase());
  });
  for(var i = 0, len = items.length; i < len; i++) {
    var parent = items[i].parentNode;
    var detatchedItem = parent.removeChild(items[i]);
    parent.appendChild(detatchedItem);
  }
}

function updateListOfZones() {
  var $cards = $(".custom-card");
  var $countries = $("#selected-countries")[0].childNodes;
  var ids = [];
  $countries.forEach(c => {
    if (c.id) ids.push(c.id);
  });
  if (ids.length === 0)
  {
    $cards.show();
    return;
  }
  $cards.hide();
  $cards.each(
    function()
    {
      var country = $(this)[0].id.split("-")[1];
      if(ids.includes(country))
      {
        $(this).show();
      }
    }
  );
};

function removeElement(element) {
    var text_to_place = $(element).parent()[0].id;
    $("#inactive-countries-list").append(
      '<div class="active-filter-selection row" id="' + text_to_place + '">' +
        '<span class="active-filter-text-list-item col-6 trn" style="display: grid; align-content:center;">' +
          text_to_place +
        '</span>' +
        '<div class="col-6" style="display: flex; justify-content: flex-end;">' +
          '<button class="btn" onclick="addElement(this)">' +
            '<i class="fas fa-plus item-icon"></i>' +
          '</button>' +
        '</div>' +
      '</div>' 
    );
    translator.lang(curr_lng);
    $(element).parent().remove();
    sortCountryNodesAlphabetically();
    updateListOfZones();
    sessionStorage.setItem(text_to_place, "inactive");
    // Reset searchbox
    $("#search-zone")[0].value = "";
};

function addElement(element) {
    // Add to active selection list:
    var text_to_place = $(element).parent().parent()[0].id;
    $("#selected-countries").append(
      '<div class="active-filter-selection" id="'+ text_to_place +'"><span class="active-filter-text trn">'+
      text_to_place +
      '</span><button class="btn" onclick="removeElement(this)"><i class="fas fa-times item-icon"></i></button></div>'
    );
    // Remove from list
    translator.lang(curr_lng);
    $(element).parent().parent().remove();
    sortCountryNodesAlphabetically();
    updateListOfZones();
    sessionStorage.setItem(text_to_place, "active");
    // close modal if open
    if (($("#country-modal").data('bs.modal') || {})._isShown)
      $('#country-modal').modal('toggle');
    // Reset searchbox
    $("#search-zone")[0].value = "";
};

function SortAsc() {
  var criteria = $("#sort-criteria")[0].value;
  $(".custom-card").sort(function(a, b) {
    if (criteria==="nvid") {
      return (parseInt($(a).find("p")[0].dataset.videos) - parseInt($(b).find("p")[0].dataset.videos))*-1;
    }
    else if (criteria==="alph")
    {
      return $(a).find("h5")[0].textContent.localeCompare($(b).find("h5")[0].textContent);
    }
  }).appendTo('#zones-list');
  sessionStorage.setItem("sortCriteria", criteria);
  sessionStorage.setItem("sortOrder", "asc");
  $("#btn-asc").hide();
  $("#btn-desc").show();
};

function SortDesc() {
  var criteria = $("#sort-criteria")[0].value;
  $(".custom-card").sort(function(a, b) {
    if (criteria==="nvid") {
      return (parseInt($(a).find("p")[0].dataset.videos) - parseInt($(b).find("p")[0].dataset.videos));
    }
    else if (criteria==="alph") {
      return ($(a).find("h5")[0].textContent.localeCompare($(b).find("h5")[0].textContent))*-1;
    }
  }).appendTo('#zones-list');
  sessionStorage.setItem("sortCriteria", criteria);
  sessionStorage.setItem("sortOrder", "des");
  $("#btn-desc").hide();
  $("#btn-asc").show();
};

function ReorderZones() {
  if (sessionStorage.getItem("sortOrder") === "asc")
      SortAsc();
  else if (sessionStorage.getItem("sortOrder") === "des")
      SortDesc();
};

function loadSessionStatus() {
  if (!sessionStorage.getItem("initialized")) {
    $("#inactive-countries-list")[0].childNodes.forEach(c => {
        if (c.tagName === 'DIV' && c.id) sessionStorage.setItem(c.id, "inactive");
      }
    );
    $("#btn-desc").hide();
    $("#btn-asc").show();
    sessionStorage.setItem("initialized", "done");
    sessionStorage.setItem("sortOrder", "asc");
    sessionStorage.setItem("sortCriteria", "alph");
    SortAsc();
  } else {
    var to_be_modified = [];
    $("#inactive-countries-list")[0].childNodes.forEach(c => {
        if (c.tagName === 'DIV') {
          // if (sessionStorage.getItem(c.id) === "inactive") removeElement($(c).find(".btn")[0])
          if (sessionStorage.getItem(c.id) === "active" )
          {
            to_be_modified.push(c);
          }
        }
      }
    );
    to_be_modified.forEach(c => addElement($(c).find(".btn")[0]));
    $("#sort-criteria")[0].value = sessionStorage.getItem("sortCriteria");
    ReorderZones();
  }
};

window.addEventListener('load', function(){
  curr_lng = $("#current-language")[0].childNodes[0].nodeValue;
  translator = $('body').translate({lang: curr_lng, t: dict}); //use English
  translator.lang(curr_lng);
  sortCountryNodesAlphabetically();
  loadSessionStatus();

  var $cards = $(".custom-card");

  $("#search-zone").keyup(function() {
      var val = $.trim(this.value).toLowerCase();
      if (val === "")
          $cards.show();
      else {
        $cards.hide();
        $cards.each(function()
        {
          if($(this).find(".card-title")[0].innerHTML.toLowerCase().indexOf(val) != -1)
          {
            $(this).show();
          }
        });
      }
      // At this point we are only showing zones that matched the search pattern,
      // Now filter by country if required
      var $countries = $("#selected-countries")[0].childNodes;
      var ids = [];
      $countries.forEach(c => {
        if (c.id) ids.push(c.id);
      });
      if (ids.length === 0)
      {
        // No Ids, everything is already ok
        return;
      }
      // IDs ?
      $cards.each(
        function()
        {
          var country = $(this)[0].id.split("-")[1];
          if(!ids.includes(country))
          {
            $(this).hide();
          }
        }
      );
  });
});
</script>

<style>
  body {
    overflow-y: scroll;
  }
  ul#lang-selector li {
    display: inline;
  }
  a.zone-card-link,
  a.zone-card-link:hover {
    color: inherit;
    text-decoration: none;
  }

  .active-filter-selection {
    background-color: black;
    border-radius: 0.3rem;
    margin: 0.2rem;
  }
  .active-filter-text-list-item {
    color: white;
    padding-left: 0.75rem;
  }  
  .active-filter-text {
    color: white;
    padding-left: 0.75rem;
    margin-right: 0.1rem;
  }
  .item-icon {
    color: white;
  }
  select {
    -webkit-appearance:none;
  }
  /* input:focus, */
  /* textarea:focus, */
  /* button:focus, */
  select:focus{
    outline: none;
  }
  @media only screen and (max-width: 600px) 
  {
    div.custom-card {
      max-width: 50%;
    }
    .zone-card {
      max-width: 70%;
      margin: 15%;
    }
  }
  @media only screen and (min-width: 600px) {
    .zone-card {
      margin: 2.5rem;
    }
  }
</style>
